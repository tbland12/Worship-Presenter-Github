"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const node_path_1 = __importDefault(require("node:path"));
const plugin_retry_1 = require("@octokit/plugin-retry");
const rest_1 = require("@octokit/rest");
const debug_1 = __importDefault(require("debug"));
const logInfo = (0, debug_1.default)('electron-forge:publisher:github:info');
const logDebug = (0, debug_1.default)('electron-forge:publisher:github:debug');
class GitHub {
    constructor(authToken = undefined, requireAuth = false, options = {}) {
        const noOp = () => {
            /* Intentionally does nothing */
        };
        this.options = {
            ...options,
            log: {
                debug: logDebug.enabled ? logDebug : noOp,
                error: console.error,
                info: logInfo.enabled ? logInfo : noOp,
                warn: console.warn,
            },
            userAgent: 'Electron Forge',
        };
        if (authToken) {
            this.token = authToken;
        }
        else if (process.env.GITHUB_TOKEN) {
            this.token = process.env.GITHUB_TOKEN;
        }
        else if (requireAuth) {
            throw new Error('Please set GITHUB_TOKEN in your environment to access these features');
        }
    }
    getGitHub() {
        const options = { ...this.options };
        if (this.token) {
            options.auth = this.token;
        }
        const RetryableOctokit = rest_1.Octokit.plugin(plugin_retry_1.retry);
        const github = new RetryableOctokit(options);
        return github;
    }
    // Based on https://github.com/cli/cli/blob/b07f955c23fb54c400b169d39255569e240b324e/pkg/cmd/release/upload/upload.go#L131-L153
    static sanitizeName(name) {
        return (node_path_1.default
            .basename(name)
            // Remove diacritics (e.g. Ã© -> e)
            .normalize('NFD')
            .replace(/\p{Diacritic}/gu, '')
            // Replace special characters with dot
            .replace(/[^\w_.@+-]+/g, '.')
            // Replace multiple dots with a single dot
            .replace(/\.+/g, '.')
            // Remove leading dot if present
            .replace(/^\./g, '')
            // Remove trailing dot if present
            .replace(/\.$/g, ''));
    }
}
exports.default = GitHub;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2l0aHViLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWwvZ2l0aHViLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsMERBQTZCO0FBRzdCLHdEQUE4QztBQUM5Qyx3Q0FBd0M7QUFDeEMsa0RBQTBCO0FBRTFCLE1BQU0sT0FBTyxHQUFHLElBQUEsZUFBSyxFQUFDLHNDQUFzQyxDQUFDLENBQUM7QUFDOUQsTUFBTSxRQUFRLEdBQUcsSUFBQSxlQUFLLEVBQUMsdUNBQXVDLENBQUMsQ0FBQztBQUVoRSxNQUFxQixNQUFNO0lBS3pCLFlBQ0UsWUFBZ0MsU0FBUyxFQUN6QyxXQUFXLEdBQUcsS0FBSyxFQUNuQixVQUEwQixFQUFFO1FBRTVCLE1BQU0sSUFBSSxHQUFHLEdBQUcsRUFBRTtZQUNoQixnQ0FBZ0M7UUFDbEMsQ0FBQyxDQUFDO1FBRUYsSUFBSSxDQUFDLE9BQU8sR0FBRztZQUNiLEdBQUcsT0FBTztZQUNWLEdBQUcsRUFBRTtnQkFDSCxLQUFLLEVBQUUsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJO2dCQUN6QyxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7Z0JBQ3BCLElBQUksRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUk7Z0JBQ3RDLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSTthQUNuQjtZQUNELFNBQVMsRUFBRSxnQkFBZ0I7U0FDNUIsQ0FBQztRQUVGLElBQUksU0FBUyxFQUFFLENBQUM7WUFDZCxJQUFJLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQztRQUN6QixDQUFDO2FBQU0sSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3BDLElBQUksQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUM7UUFDeEMsQ0FBQzthQUFNLElBQUksV0FBVyxFQUFFLENBQUM7WUFDdkIsTUFBTSxJQUFJLEtBQUssQ0FDYixzRUFBc0UsQ0FDdkUsQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0lBRUQsU0FBUztRQUNQLE1BQU0sT0FBTyxHQUFtQixFQUFFLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3BELElBQUksSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQzVCLENBQUM7UUFDRCxNQUFNLGdCQUFnQixHQUFHLGNBQU8sQ0FBQyxNQUFNLENBQUMsb0JBQUssQ0FBQyxDQUFDO1FBQy9DLE1BQU0sTUFBTSxHQUFHLElBQUksZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDN0MsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVELCtIQUErSDtJQUMvSCxNQUFNLENBQUMsWUFBWSxDQUFDLElBQVk7UUFDOUIsT0FBTyxDQUNMLG1CQUFJO2FBQ0QsUUFBUSxDQUFDLElBQUksQ0FBQztZQUNmLGtDQUFrQzthQUNqQyxTQUFTLENBQUMsS0FBSyxDQUFDO2FBQ2hCLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSxFQUFFLENBQUM7WUFDL0Isc0NBQXNDO2FBQ3JDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsR0FBRyxDQUFDO1lBQzdCLDBDQUEwQzthQUN6QyxPQUFPLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQztZQUNyQixnQ0FBZ0M7YUFDL0IsT0FBTyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUM7WUFDcEIsaUNBQWlDO2FBQ2hDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQ3ZCLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUFoRUQseUJBZ0VDIn0=